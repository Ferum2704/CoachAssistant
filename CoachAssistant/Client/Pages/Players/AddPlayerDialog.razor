@using AutoMapper

<MudDialog>
    <DialogContent>
        <EditForm Model="@playerModel">
            <MudGrid Justify="Justify.Center">
                <MudItem xs="12" sm="6" md="4">
                    <MudTextField Label="Name" @bind-Value="playerModel.Name" />
                    <MudTextField Label="Surname" @bind-Value="playerModel.Surname" />
                    <MudTextField Label="Email" @bind-Value="playerModel.Email" />
                    <MudTextField Label="Weight" @bind-Value="playerModel.Weight" />
                    <MudTextField Label="Height" @bind-Value="playerModel.Height" />
                </MudItem>
            </MudGrid>
        </EditForm>
    </DialogContent>
    <DialogActions>
        <MudButton Type="ButtonType.Submit" Color="Color.Primary" Variant="Variant.Filled" OnClick="@HandleValidSubmit">Save</MudButton>
    </DialogActions>
</MudDialog>

@inject IHttpClientService HttpClientService
@inject ILocalStorageService LocalStorage
@inject ICurrentTeamProvider CurrentTeamProvider
@inject IMapper Mapper

@code {
    private HubConnection hubConnection;
    private PlayerModel playerModel = new();

    [CascadingParameter] MudDialogInstance MudDialog { get; set; }

    async Task HandleValidSubmit()
    {
        var player = await HttpClientService.PostAsync<PlayerModel, PlayerViewModel>(ApiUrls.GetPostPlayerUrl(CurrentTeamProvider.CurrentClub.Team.Id), playerModel);

        MudDialog.Close(DialogResult.Ok(player));
    }
}
